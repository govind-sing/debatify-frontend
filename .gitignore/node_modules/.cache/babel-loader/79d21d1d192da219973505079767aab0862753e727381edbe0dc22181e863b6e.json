{"ast":null,"code":"import React,{useEffect,useState,useCallback,useMemo}from\"react\";import{useParams,Link,useLocation}from\"react-router-dom\";import API from\"../api/axiosInstance\";import{motion}from\"framer-motion\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DiscussionPage=()=>{var _discussion$author,_discussion$author2,_location$state,_discussion$author3,_location$state2;const{id}=useParams();const location=useLocation();const[discussion,setDiscussion]=useState(null);const[originalComments,setOriginalComments]=useState([]);const[comment,setComment]=useState(\"\");const[loading,setLoading]=useState(true);const[voting,setVoting]=useState(false);const[commenting,setCommenting]=useState(false);const[isBookmarking,setIsBookmarking]=useState(false);const[error,setError]=useState(null);const[passcode,setPasscode]=useState(\"\");const[passcodeRequired,setPasscodeRequired]=useState(false);const[enteredPasscode,setEnteredPasscode]=useState(null);const[sortBy,setSortBy]=useState(\"latest\");const fetchDiscussion=useCallback(async function(){let enteredPasscodeParam=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;try{setLoading(true);setError(null);const passcodeToUse=enteredPasscodeParam||enteredPasscode;const url=passcodeToUse?`/discussions/${id}?passcode=${encodeURIComponent(passcodeToUse)}`:`/discussions/${id}`;const{data}=await API.get(url);setDiscussion(data);setOriginalComments(data.comments||[]);if(enteredPasscodeParam)setEnteredPasscode(enteredPasscodeParam);setPasscodeRequired(false);}catch(err){var _err$response,_err$response2;console.error(\"Fetch error:\",((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err.message);if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setPasscodeRequired(true);if(enteredPasscodeParam)setError(\"Incorrect passcode. Please try again.\");}else{var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||\"Failed to load discussion.\");}}finally{setLoading(false);}},[id,enteredPasscode]);useEffect(()=>{fetchDiscussion();},[fetchDiscussion]);useEffect(()=>{const intervalId=setInterval(async()=>{try{const url=enteredPasscode?`/discussions/${id}?passcode=${encodeURIComponent(enteredPasscode)}&poll=true`:`/discussions/${id}&poll=true`;const{data}=await API.get(url);const newDiscussion=data;setDiscussion(prev=>{if(prev.upvotes!==newDiscussion.upvotes||prev.downvotes!==newDiscussion.downvotes||prev.bookmarkCount!==newDiscussion.bookmarkCount||prev.isBookmarked!==newDiscussion.isBookmarked||prev.views!==newDiscussion.views||JSON.stringify(prev.upvotedBy)!==JSON.stringify(newDiscussion.upvotedBy)||JSON.stringify(prev.downvotedBy)!==JSON.stringify(newDiscussion.downvotedBy)){return{...prev,upvotes:newDiscussion.upvotes||0,downvotes:newDiscussion.downvotes||0,bookmarkCount:newDiscussion.bookmarkCount||0,isBookmarked:newDiscussion.isBookmarked,views:newDiscussion.views||0,upvotedBy:newDiscussion.upvotedBy||prev.upvotedBy,downvotedBy:newDiscussion.downvotedBy||prev.downvotedBy};}return prev;});const newComments=newDiscussion.comments||[];const existingCommentIds=new Set(originalComments.map(c=>c._id));const commentsToAdd=newComments.filter(c=>!existingCommentIds.has(c._id));if(commentsToAdd.length>0){setOriginalComments(prevComments=>[...prevComments,...commentsToAdd]);}setOriginalComments(prevComments=>prevComments.map(prevComment=>{const updatedComment=newComments.find(c=>c._id===prevComment._id);if(updatedComment&&(prevComment.likes!==updatedComment.likes||JSON.stringify(prevComment.likedBy)!==JSON.stringify(updatedComment.likedBy))){return{...prevComment,likes:updatedComment.likes,likedBy:updatedComment.likedBy};}return prevComment;}));}catch(error){console.error(\"Error polling discussion:\",error);}},2000);return()=>clearInterval(intervalId);},[id,originalComments,enteredPasscode]);const sortedComments=useMemo(()=>{const commentsCopy=[...originalComments];if(sortBy===\"mostLiked\"){return commentsCopy.sort((a,b)=>(b.likes||0)-(a.likes||0));}else if(sortBy===\"earliest\"){return commentsCopy.sort((a,b)=>new Date(a.createdAt)-new Date(b.createdAt));}return commentsCopy.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));},[sortBy,originalComments]);const handlePasscodeSubmit=e=>{e.preventDefault();if(!passcode.trim())return setError(\"Please enter a passcode.\");fetchDiscussion(passcode);};const handleVote=async voteType=>{try{setVoting(true);setError(null);const token=localStorage.getItem(\"token\");if(!token)return setError(\"You must be logged in to vote.\");const endpoint=voteType===\"upvote\"?`/discussions/${id}/upvote`:`/discussions/${id}/downvote`;const{data}=await API.post(endpoint,{},{headers:{Authorization:`Bearer ${token}`}});setDiscussion(prev=>({...prev,upvotes:data.upvotes||0,downvotes:data.downvotes||0,upvotedBy:data.upvotedBy||prev.upvotedBy,downvotedBy:data.downvotedBy||prev.downvotedBy}));}catch(err){var _err$response4,_err$response5,_err$response5$data;console.error(\"Voting error:\",((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.data)||err.message);setError(((_err$response5=err.response)===null||_err$response5===void 0?void 0:(_err$response5$data=_err$response5.data)===null||_err$response5$data===void 0?void 0:_err$response5$data.message)||\"Failed to vote.\");}finally{setVoting(false);}};const handleBookmark=async()=>{try{setIsBookmarking(true);setError(null);const token=localStorage.getItem(\"token\");if(!token){setError(\"You must be logged in to bookmark.\");return;}const{data}=await API.post(`/discussions/${id}/bookmark`,{},{headers:{Authorization:`Bearer ${token}`}});setDiscussion(prev=>({...prev,bookmarkCount:data.bookmarkCount,isBookmarked:data.isBookmarked}));}catch(err){var _err$response6,_err$response7,_err$response7$data;console.error(\"Bookmarking error:\",((_err$response6=err.response)===null||_err$response6===void 0?void 0:_err$response6.data)||err.message);setError(((_err$response7=err.response)===null||_err$response7===void 0?void 0:(_err$response7$data=_err$response7.data)===null||_err$response7$data===void 0?void 0:_err$response7$data.message)||\"Failed to bookmark.\");}finally{setIsBookmarking(false);}};const handleComment=async()=>{try{setCommenting(true);setError(null);const token=localStorage.getItem(\"token\");if(!token)return setError(\"You must be logged in to comment.\");if(!comment.trim())return setError(\"Comment cannot be empty.\");const{data}=await API.post(`/discussions/${id}/comment`,{text:comment},{headers:{Authorization:`Bearer ${token}`}});const newComment=data.comments[data.comments.length-1];setOriginalComments(prevComments=>[...prevComments,newComment]);setComment(\"\");}catch(err){var _err$response8,_err$response9,_err$response9$data;console.error(\"Commenting error:\",((_err$response8=err.response)===null||_err$response8===void 0?void 0:_err$response8.data)||err.message);setError(((_err$response9=err.response)===null||_err$response9===void 0?void 0:(_err$response9$data=_err$response9.data)===null||_err$response9$data===void 0?void 0:_err$response9$data.message)||\"Failed to comment.\");}finally{setCommenting(false);}};const handleCommentLike=async commentId=>{try{setError(null);const token=localStorage.getItem(\"token\");if(!token)return setError(\"You must be logged in to like a comment.\");const{data}=await API.post(`/discussions/${id}/comment/${commentId}/like`,{},{headers:{Authorization:`Bearer ${token}`}});setOriginalComments(prev=>prev.map(c=>c._id===commentId?{...c,likes:data.likes,likedBy:data.likedBy}:c));}catch(err){var _err$response10,_err$response11,_err$response11$data;console.error(\"Liking comment error:\",((_err$response10=err.response)===null||_err$response10===void 0?void 0:_err$response10.data)||err.message);setError(((_err$response11=err.response)===null||_err$response11===void 0?void 0:(_err$response11$data=_err$response11.data)===null||_err$response11$data===void 0?void 0:_err$response11$data.message)||\"Failed to like comment.\");}};if(loading)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center mt-5 md:mt-10 text-gray-600 text-base md:text-lg\",children:\"Loading discussion...\"});if(!discussion&&!passcodeRequired)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center mt-5 md:mt-10 text-red-500 text-base md:text-lg\",children:\"Discussion not found.\"});if(passcodeRequired){return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen flex flex-col justify-center items-center bg-gradient-to-r from-blue-50 to-purple-50 p-4 md:p-5 md:ml-64\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl md:text-2xl font-bold mb-4 text-gray-800\",children:\"This is a Private Discussion\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handlePasscodeSubmit,className:\"bg-white shadow-lg rounded-lg p-4 md:p-6 w-full max-w-md\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block mb-2 text-gray-700 text-sm md:text-base\",children:\"Enter Passcode:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:passcode,onChange:e=>setPasscode(e.target.value),className:\"w-full p-2 md:p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\",required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition-colors duration-200 text-sm md:text-base\",children:\"Submit\"})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-red-600 text-sm md:text-base\",children:error})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-r from-blue-50 to-purple-50 p-4 md:p-5 md:ml-64\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-2 md:p-3 bg-red-100 text-red-700 rounded-md text-center text-sm md:text-base\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-4 md:p-5\",children:/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:0.5},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl md:text-4xl font-bold text-gray-800 mb-2\",children:discussion.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4 text-sm md:text-base\",children:discussion.description}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs md:text-sm text-blue-600 mb-4\",children:[\"Category: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:discussion.category}),\" | By:\",\" \",/*#__PURE__*/_jsx(Link,{to:`/profile/${((_discussion$author=discussion.author)===null||_discussion$author===void 0?void 0:_discussion$author.username)||\"unknown\"}`,className:\"font-semibold hover:underline\",children:((_discussion$author2=discussion.author)===null||_discussion$author2===void 0?void 0:_discussion$author2.username)||\"Unknown\"}),\" \",\"| Created:\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:discussion.createdAt?new Date(discussion.createdAt).toLocaleString():\"Unknown\"}),\" \",\"| Views: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:discussion.views||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:space-x-4 mb-4 md:mb-6 space-y-2 sm:space-y-0\",children:[/*#__PURE__*/_jsxs(motion.div,{className:`flex items-center rounded-full bg-gray-100 shadow-sm text-sm md:text-base ${voting?\"opacity-50 cursor-not-allowed\":\"hover:bg-gray-200\"}`,whileHover:{scale:voting?1:1.05},whileTap:{scale:voting?1:0.95},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleVote(\"upvote\"),disabled:voting,className:\"flex items-center px-2 py-1 md:px-3 md:py-2 text-gray-700 hover:text-green-600\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4 md:h-5 md:w-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M5 15l7-7 7 7\"})})}),/*#__PURE__*/_jsx(\"span\",{className:\"px-1 md:px-2 text-gray-800 font-medium\",children:(discussion.upvotes||0)-(discussion.downvotes||0)}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleVote(\"downvote\"),disabled:voting,className:\"flex items-center px-2 py-1 md:px-3 md:py-2 text-gray-700 hover:text-red-600\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4 md:h-5 md:w-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M19 9l-7 7-7-7\"})})})]}),/*#__PURE__*/_jsx(motion.div,{className:`flex items-center rounded-full bg-gray-100 shadow-sm text-sm md:text-base ${isBookmarking?\"opacity-50 cursor-not-allowed\":\"hover:bg-gray-200\"} ${discussion.isBookmarked?\"bg-yellow-100 text-yellow-700\":\"text-gray-700\"}`,whileHover:{scale:isBookmarking?1:1.05},whileTap:{scale:isBookmarking?1:0.95},children:/*#__PURE__*/_jsxs(\"button\",{onClick:handleBookmark,disabled:isBookmarking,className:\"flex items-center px-2 py-1 md:px-3 md:py-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4 md:h-5 md:w-5 mr-1 md:mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-5-7 5V5z\"})}),/*#__PURE__*/_jsx(\"span\",{children:discussion.bookmarkCount||0})]})})]}),/*#__PURE__*/_jsx(\"textarea\",{value:comment,onChange:e=>setComment(e.target.value),className:\"w-full p-2 md:p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2 text-sm md:text-base\",placeholder:\"Write a comment...\",rows:\"3\"}),/*#__PURE__*/_jsxs(motion.button,{whileHover:{scale:1.05},whileTap:{scale:0.95},onClick:handleComment,disabled:commenting,className:`w-full flex items-center justify-center px-3 py-1 md:px-4 md:py-2 rounded-lg shadow-md transition-colors duration-200 text-sm md:text-base ${commenting?\"bg-blue-300 cursor-not-allowed\":\"bg-blue-500 hover:bg-blue-600\"} text-white`,children:[/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4 md:h-5 md:w-5 mr-1 md:mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"})}),commenting?\"Posting...\":\"Post Comment\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto mt-4 md:mt-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row justify-between items-center mb-4 space-y-2 sm:space-y-0\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl md:text-2xl font-bold text-gray-800\",children:\"Comments\"}),/*#__PURE__*/_jsxs(\"select\",{value:sortBy,onChange:e=>setSortBy(e.target.value),className:\"px-2 py-1 md:px-3 md:py-1 border rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"latest\",children:\"Latest\"}),/*#__PURE__*/_jsx(\"option\",{value:\"mostLiked\",children:\"Popular\"}),/*#__PURE__*/_jsx(\"option\",{value:\"earliest\",children:\"Earliest\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-[50vh] md:max-h-[calc(100vh-24rem)] overflow-y-auto border rounded-lg p-3 md:p-4 bg-white shadow-md\",children:sortedComments.length>0?sortedComments.map(c=>{var _c$user,_c$user2,_c$likedBy,_JSON$parse,_localStorage$getItem;return/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:0.3},className:\"border-b py-2 md:py-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 text-sm md:text-base\",children:c.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row justify-between items-start sm:items-center mt-1\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs md:text-sm text-gray-500\",children:[\"By:\",\" \",/*#__PURE__*/_jsx(Link,{to:`/profile/${((_c$user=c.user)===null||_c$user===void 0?void 0:_c$user.username)||\"unknown\"}`,className:\"hover:underline\",children:((_c$user2=c.user)===null||_c$user2===void 0?void 0:_c$user2.username)||\"Unknown\"}),\" \",\"| \",new Date(c.createdAt).toLocaleString()]}),/*#__PURE__*/_jsx(motion.div,{className:`flex items-center rounded-full bg-gray-100 shadow-sm text-sm md:text-base hover:bg-gray-200 ${(_c$likedBy=c.likedBy)!==null&&_c$likedBy!==void 0&&_c$likedBy.includes((_JSON$parse=JSON.parse(atob((_localStorage$getItem=localStorage.getItem(\"token\"))===null||_localStorage$getItem===void 0?void 0:_localStorage$getItem.split(\".\")[1])))===null||_JSON$parse===void 0?void 0:_JSON$parse.userId)?\"bg-pink-100 text-pink-700\":\"text-gray-700\"}`,whileHover:{scale:1.05},whileTap:{scale:0.95},children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleCommentLike(c._id),className:\"flex items-center px-2 py-1 md:px-3 md:py-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"h-3 w-3 md:h-4 md:w-4 mr-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"})}),/*#__PURE__*/_jsx(\"span\",{children:c.likes||0})]})})]})]},c._id);}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-center text-sm md:text-base\",children:\"No comments yet. Be the first to comment!\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto text-center mt-6 md:mt-8 space-x-4\",children:[/*#__PURE__*/_jsx(Link,{to:`/profile/${((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.fromProfile)||((_discussion$author3=discussion.author)===null||_discussion$author3===void 0?void 0:_discussion$author3.username)||\"unknown\"}`,state:{activeTab:((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.activeTab)||\"discussion\"},className:\"text-blue-600 hover:underline font-semibold text-sm md:text-base\",children:\"\\u2190 Back to Profile\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"text-blue-600 hover:underline font-semibold text-sm md:text-base\",children:\"\\u2190 Back to Home\"})]})]});};export default DiscussionPage;","map":{"version":3,"names":["React","useEffect","useState","useCallback","useMemo","useParams","Link","useLocation","API","motion","jsx","_jsx","jsxs","_jsxs","DiscussionPage","_discussion$author","_discussion$author2","_location$state","_discussion$author3","_location$state2","id","location","discussion","setDiscussion","originalComments","setOriginalComments","comment","setComment","loading","setLoading","voting","setVoting","commenting","setCommenting","isBookmarking","setIsBookmarking","error","setError","passcode","setPasscode","passcodeRequired","setPasscodeRequired","enteredPasscode","setEnteredPasscode","sortBy","setSortBy","fetchDiscussion","enteredPasscodeParam","arguments","length","undefined","passcodeToUse","url","encodeURIComponent","data","get","comments","err","_err$response","_err$response2","console","response","message","status","_err$response3","_err$response3$data","intervalId","setInterval","newDiscussion","prev","upvotes","downvotes","bookmarkCount","isBookmarked","views","JSON","stringify","upvotedBy","downvotedBy","newComments","existingCommentIds","Set","map","c","_id","commentsToAdd","filter","has","prevComments","prevComment","updatedComment","find","likes","likedBy","clearInterval","sortedComments","commentsCopy","sort","a","b","Date","createdAt","handlePasscodeSubmit","e","preventDefault","trim","handleVote","voteType","token","localStorage","getItem","endpoint","post","headers","Authorization","_err$response4","_err$response5","_err$response5$data","handleBookmark","_err$response6","_err$response7","_err$response7$data","handleComment","text","newComment","_err$response8","_err$response9","_err$response9$data","handleCommentLike","commentId","_err$response10","_err$response11","_err$response11$data","className","children","onSubmit","type","value","onChange","target","required","div","initial","opacity","y","animate","transition","duration","title","description","category","to","author","username","toLocaleString","whileHover","scale","whileTap","onClick","disabled","fill","stroke","viewBox","xmlns","strokeLinecap","strokeLinejoin","strokeWidth","d","placeholder","rows","button","_c$user","_c$user2","_c$likedBy","_JSON$parse","_localStorage$getItem","user","includes","parse","atob","split","userId","state","fromProfile","activeTab"],"sources":["/Users/govindsinghtanwar/coding/Projects/debatify/frontend/src/pages/DiscussionPage.js"],"sourcesContent":["import React, { useEffect, useState, useCallback, useMemo } from \"react\";\nimport { useParams, Link, useLocation } from \"react-router-dom\";\nimport API from \"../api/axiosInstance\";\nimport { motion } from \"framer-motion\";\n\nconst DiscussionPage = () => {\n  const { id } = useParams();\n  const location = useLocation();\n  const [discussion, setDiscussion] = useState(null);\n  const [originalComments, setOriginalComments] = useState([]);\n  const [comment, setComment] = useState(\"\");\n  const [loading, setLoading] = useState(true);\n  const [voting, setVoting] = useState(false);\n  const [commenting, setCommenting] = useState(false);\n  const [isBookmarking, setIsBookmarking] = useState(false);\n  const [error, setError] = useState(null);\n  const [passcode, setPasscode] = useState(\"\");\n  const [passcodeRequired, setPasscodeRequired] = useState(false);\n  const [enteredPasscode, setEnteredPasscode] = useState(null);\n  const [sortBy, setSortBy] = useState(\"latest\");\n\n  const fetchDiscussion = useCallback(\n    async (enteredPasscodeParam = null) => {\n      try {\n        setLoading(true);\n        setError(null);\n        const passcodeToUse = enteredPasscodeParam || enteredPasscode;\n        const url = passcodeToUse\n          ? `/discussions/${id}?passcode=${encodeURIComponent(passcodeToUse)}`\n          : `/discussions/${id}`;\n        const { data } = await API.get(url);\n        setDiscussion(data);\n        setOriginalComments(data.comments || []);\n        if (enteredPasscodeParam) setEnteredPasscode(enteredPasscodeParam);\n        setPasscodeRequired(false);\n      } catch (err) {\n        console.error(\"Fetch error:\", err.response?.data || err.message);\n        if (err.response?.status === 401) {\n          setPasscodeRequired(true);\n          if (enteredPasscodeParam) setError(\"Incorrect passcode. Please try again.\");\n        } else {\n          setError(err.response?.data?.message || \"Failed to load discussion.\");\n        }\n      } finally {\n        setLoading(false);\n      }\n    },\n    [id, enteredPasscode]\n  );\n\n  useEffect(() => {\n    fetchDiscussion();\n  }, [fetchDiscussion]);\n\n  useEffect(() => {\n    const intervalId = setInterval(async () => {\n      try {\n        const url = enteredPasscode\n          ? `/discussions/${id}?passcode=${encodeURIComponent(enteredPasscode)}&poll=true`\n          : `/discussions/${id}&poll=true`;\n        const { data } = await API.get(url);\n        const newDiscussion = data;\n\n        setDiscussion((prev) => {\n          if (\n            prev.upvotes !== newDiscussion.upvotes ||\n            prev.downvotes !== newDiscussion.downvotes ||\n            prev.bookmarkCount !== newDiscussion.bookmarkCount ||\n            prev.isBookmarked !== newDiscussion.isBookmarked ||\n            prev.views !== newDiscussion.views ||\n            JSON.stringify(prev.upvotedBy) !== JSON.stringify(newDiscussion.upvotedBy) ||\n            JSON.stringify(prev.downvotedBy) !== JSON.stringify(newDiscussion.downvotedBy)\n          ) {\n            return {\n              ...prev,\n              upvotes: newDiscussion.upvotes || 0,\n              downvotes: newDiscussion.downvotes || 0,\n              bookmarkCount: newDiscussion.bookmarkCount || 0,\n              isBookmarked: newDiscussion.isBookmarked,\n              views: newDiscussion.views || 0,\n              upvotedBy: newDiscussion.upvotedBy || prev.upvotedBy,\n              downvotedBy: newDiscussion.downvotedBy || prev.downvotedBy,\n            };\n          }\n          return prev;\n        });\n\n        const newComments = newDiscussion.comments || [];\n        const existingCommentIds = new Set(originalComments.map((c) => c._id));\n        const commentsToAdd = newComments.filter((c) => !existingCommentIds.has(c._id));\n        if (commentsToAdd.length > 0) {\n          setOriginalComments((prevComments) => [...prevComments, ...commentsToAdd]);\n        }\n\n        setOriginalComments((prevComments) =>\n          prevComments.map((prevComment) => {\n            const updatedComment = newComments.find((c) => c._id === prevComment._id);\n            if (\n              updatedComment &&\n              (prevComment.likes !== updatedComment.likes ||\n                JSON.stringify(prevComment.likedBy) !== JSON.stringify(updatedComment.likedBy))\n            ) {\n              return { ...prevComment, likes: updatedComment.likes, likedBy: updatedComment.likedBy };\n            }\n            return prevComment;\n          })\n        );\n      } catch (error) {\n        console.error(\"Error polling discussion:\", error);\n      }\n    }, 2000);\n\n    return () => clearInterval(intervalId);\n  }, [id, originalComments, enteredPasscode]);\n\n  const sortedComments = useMemo(() => {\n    const commentsCopy = [...originalComments];\n    if (sortBy === \"mostLiked\") {\n      return commentsCopy.sort((a, b) => (b.likes || 0) - (a.likes || 0));\n    } else if (sortBy === \"earliest\") {\n      return commentsCopy.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));\n    }\n    return commentsCopy.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n  }, [sortBy, originalComments]);\n\n  const handlePasscodeSubmit = (e) => {\n    e.preventDefault();\n    if (!passcode.trim()) return setError(\"Please enter a passcode.\");\n    fetchDiscussion(passcode);\n  };\n\n  const handleVote = async (voteType) => {\n    try {\n      setVoting(true);\n      setError(null);\n      const token = localStorage.getItem(\"token\");\n      if (!token) return setError(\"You must be logged in to vote.\");\n\n      const endpoint = voteType === \"upvote\" ? `/discussions/${id}/upvote` : `/discussions/${id}/downvote`;\n      const { data } = await API.post(endpoint, {}, { headers: { Authorization: `Bearer ${token}` } });\n\n      setDiscussion((prev) => ({\n        ...prev,\n        upvotes: data.upvotes || 0,\n        downvotes: data.downvotes || 0,\n        upvotedBy: data.upvotedBy || prev.upvotedBy,\n        downvotedBy: data.downvotedBy || prev.downvotedBy,\n      }));\n    } catch (err) {\n      console.error(\"Voting error:\", err.response?.data || err.message);\n      setError(err.response?.data?.message || \"Failed to vote.\");\n    } finally {\n      setVoting(false);\n    }\n  };\n\n  const handleBookmark = async () => {\n    try {\n      setIsBookmarking(true);\n      setError(null);\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        setError(\"You must be logged in to bookmark.\");\n        return;\n      }\n      const { data } = await API.post(`/discussions/${id}/bookmark`, {}, { headers: { Authorization: `Bearer ${token}` } });\n\n      setDiscussion((prev) => ({\n        ...prev,\n        bookmarkCount: data.bookmarkCount,\n        isBookmarked: data.isBookmarked,\n      }));\n    } catch (err) {\n      console.error(\"Bookmarking error:\", err.response?.data || err.message);\n      setError(err.response?.data?.message || \"Failed to bookmark.\");\n    } finally {\n      setIsBookmarking(false);\n    }\n  };\n\n  const handleComment = async () => {\n    try {\n      setCommenting(true);\n      setError(null);\n      const token = localStorage.getItem(\"token\");\n      if (!token) return setError(\"You must be logged in to comment.\");\n      if (!comment.trim()) return setError(\"Comment cannot be empty.\");\n\n      const { data } = await API.post(\n        `/discussions/${id}/comment`,\n        { text: comment },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      const newComment = data.comments[data.comments.length - 1];\n      setOriginalComments((prevComments) => [...prevComments, newComment]);\n      setComment(\"\");\n    } catch (err) {\n      console.error(\"Commenting error:\", err.response?.data || err.message);\n      setError(err.response?.data?.message || \"Failed to comment.\");\n    } finally {\n      setCommenting(false);\n    }\n  };\n\n  const handleCommentLike = async (commentId) => {\n    try {\n      setError(null);\n      const token = localStorage.getItem(\"token\");\n      if (!token) return setError(\"You must be logged in to like a comment.\");\n\n      const { data } = await API.post(\n        `/discussions/${id}/comment/${commentId}/like`,\n        {},\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      setOriginalComments((prev) =>\n        prev.map((c) => (c._id === commentId ? { ...c, likes: data.likes, likedBy: data.likedBy } : c))\n      );\n    } catch (err) {\n      console.error(\"Liking comment error:\", err.response?.data || err.message);\n      setError(err.response?.data?.message || \"Failed to like comment.\");\n    }\n  };\n\n  if (loading)\n    return <p className=\"text-center mt-5 md:mt-10 text-gray-600 text-base md:text-lg\">Loading discussion...</p>;\n  if (!discussion && !passcodeRequired)\n    return <p className=\"text-center mt-5 md:mt-10 text-red-500 text-base md:text-lg\">Discussion not found.</p>;\n\n  if (passcodeRequired) {\n    return (\n      <div className=\"min-h-screen flex flex-col justify-center items-center bg-gradient-to-r from-blue-50 to-purple-50 p-4 md:p-5 md:ml-64\">\n        <h2 className=\"text-xl md:text-2xl font-bold mb-4 text-gray-800\">This is a Private Discussion</h2>\n        <form\n          onSubmit={handlePasscodeSubmit}\n          className=\"bg-white shadow-lg rounded-lg p-4 md:p-6 w-full max-w-md\"\n        >\n          <label className=\"block mb-2 text-gray-700 text-sm md:text-base\">Enter Passcode:</label>\n          <input\n            type=\"password\"\n            value={passcode}\n            onChange={(e) => setPasscode(e.target.value)}\n            className=\"w-full p-2 md:p-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\"\n            required\n          />\n          <button\n            type=\"submit\"\n            className=\"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition-colors duration-200 text-sm md:text-base\"\n          >\n            Submit\n          </button>\n        </form>\n        {error && <p className=\"mt-4 text-red-600 text-sm md:text-base\">{error}</p>}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-r from-blue-50 to-purple-50 p-4 md:p-5 md:ml-64\">\n      {error && (\n        <div className=\"mb-4 p-2 md:p-3 bg-red-100 text-red-700 rounded-md text-center text-sm md:text-base\">\n          {error}\n        </div>\n      )}\n\n      <div className=\"max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-4 md:p-5\">\n        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }}>\n          <h2 className=\"text-2xl md:text-4xl font-bold text-gray-800 mb-2\">{discussion.title}</h2>\n          <p className=\"text-gray-600 mb-4 text-sm md:text-base\">{discussion.description}</p>\n          <p className=\"text-xs md:text-sm text-blue-600 mb-4\">\n            Category: <span className=\"font-semibold\">{discussion.category}</span> | By:{\" \"}\n            <Link\n              to={`/profile/${discussion.author?.username || \"unknown\"}`}\n              className=\"font-semibold hover:underline\"\n            >\n              {discussion.author?.username || \"Unknown\"}\n            </Link>{\" \"}\n            | Created:{\" \"}\n            <span className=\"font-semibold\">\n              {discussion.createdAt ? new Date(discussion.createdAt).toLocaleString() : \"Unknown\"}\n            </span>{\" \"}\n            | Views: <span className=\"font-semibold\">{discussion.views || 0}</span>\n          </p>\n\n          <div className=\"flex flex-col sm:flex-row sm:space-x-4 mb-4 md:mb-6 space-y-2 sm:space-y-0\">\n            {/* Upvote/Downvote Button */}\n            <motion.div\n              className={`flex items-center rounded-full bg-gray-100 shadow-sm text-sm md:text-base ${\n                voting ? \"opacity-50 cursor-not-allowed\" : \"hover:bg-gray-200\"\n              }`}\n              whileHover={{ scale: voting ? 1 : 1.05 }}\n              whileTap={{ scale: voting ? 1 : 0.95 }}\n            >\n              <button\n                onClick={() => handleVote(\"upvote\")}\n                disabled={voting}\n                className=\"flex items-center px-2 py-1 md:px-3 md:py-2 text-gray-700 hover:text-green-600\"\n              >\n                <svg\n                  className=\"h-4 w-4 md:h-5 md:w-5\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M5 15l7-7 7 7\"\n                  />\n                </svg>\n              </button>\n              <span className=\"px-1 md:px-2 text-gray-800 font-medium\">\n                {(discussion.upvotes || 0) - (discussion.downvotes || 0)}\n              </span>\n              <button\n                onClick={() => handleVote(\"downvote\")}\n                disabled={voting}\n                className=\"flex items-center px-2 py-1 md:px-3 md:py-2 text-gray-700 hover:text-red-600\"\n              >\n                <svg\n                  className=\"h-4 w-4 md:h-5 md:w-5\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M19 9l-7 7-7-7\"\n                  />\n                </svg>\n              </button>\n            </motion.div>\n\n            {/* Bookmark Button */}\n            <motion.div\n              className={`flex items-center rounded-full bg-gray-100 shadow-sm text-sm md:text-base ${\n                isBookmarking ? \"opacity-50 cursor-not-allowed\" : \"hover:bg-gray-200\"\n              } ${\n                discussion.isBookmarked ? \"bg-yellow-100 text-yellow-700\" : \"text-gray-700\"\n              }`}\n              whileHover={{ scale: isBookmarking ? 1 : 1.05 }}\n              whileTap={{ scale: isBookmarking ? 1 : 0.95 }}\n            >\n              <button\n                onClick={handleBookmark}\n                disabled={isBookmarking}\n                className=\"flex items-center px-2 py-1 md:px-3 md:py-2\"\n              >\n                <svg\n                  className=\"h-4 w-4 md:h-5 md:w-5 mr-1 md:mr-2\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth=\"2\"\n                    d=\"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-5-7 5V5z\"\n                  />\n                </svg>\n                <span>{discussion.bookmarkCount || 0}</span>\n              </button>\n            </motion.div>\n          </div>\n\n          <textarea\n            value={comment}\n            onChange={(e) => setComment(e.target.value)}\n            className=\"w-full p-2 md:p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2 text-sm md:text-base\"\n            placeholder=\"Write a comment...\"\n            rows=\"3\"\n          />\n          <motion.button\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={handleComment}\n            disabled={commenting}\n            className={`w-full flex items-center justify-center px-3 py-1 md:px-4 md:py-2 rounded-lg shadow-md transition-colors duration-200 text-sm md:text-base ${\n              commenting ? \"bg-blue-300 cursor-not-allowed\" : \"bg-blue-500 hover:bg-blue-600\"\n            } text-white`}\n          >\n            <svg\n              className=\"h-4 w-4 md:h-5 md:w-5 mr-1 md:mr-2\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth=\"2\"\n                d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"\n              />\n            </svg>\n            {commenting ? \"Posting...\" : \"Post Comment\"}\n          </motion.button>\n        </motion.div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto mt-4 md:mt-6\">\n        <div className=\"flex flex-col sm:flex-row justify-between items-center mb-4 space-y-2 sm:space-y-0\">\n          <h3 className=\"text-xl md:text-2xl font-bold text-gray-800\">Comments</h3>\n          <select\n            value={sortBy}\n            onChange={(e) => setSortBy(e.target.value)}\n            className=\"px-2 py-1 md:px-3 md:py-1 border rounded-lg bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\"\n          >\n            <option value=\"latest\">Latest</option>\n            <option value=\"mostLiked\">Popular</option>\n            <option value=\"earliest\">Earliest</option>\n          </select>\n        </div>\n\n        <div className=\"max-h-[50vh] md:max-h-[calc(100vh-24rem)] overflow-y-auto border rounded-lg p-3 md:p-4 bg-white shadow-md\">\n          {sortedComments.length > 0 ? (\n            sortedComments.map((c) => (\n              <motion.div\n                key={c._id}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3 }}\n                className=\"border-b py-2 md:py-3\"\n              >\n                <p className=\"text-gray-700 text-sm md:text-base\">{c.text}</p>\n                <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mt-1\">\n                  <p className=\"text-xs md:text-sm text-gray-500\">\n                    By:{\" \"}\n                    <Link\n                      to={`/profile/${c.user?.username || \"unknown\"}`}\n                      className=\"hover:underline\"\n                    >\n                      {c.user?.username || \"Unknown\"}\n                    </Link>{\" \"}\n                    | {new Date(c.createdAt).toLocaleString()}\n                  </p>\n                  {/* Comment Like Button */}\n                  <motion.div\n                    className={`flex items-center rounded-full bg-gray-100 shadow-sm text-sm md:text-base hover:bg-gray-200 ${\n                      c.likedBy?.includes(JSON.parse(atob(localStorage.getItem(\"token\")?.split(\".\")[1]))?.userId)\n                        ? \"bg-pink-100 text-pink-700\"\n                        : \"text-gray-700\"\n                    }`}\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                  >\n                    <button\n                      onClick={() => handleCommentLike(c._id)}\n                      className=\"flex items-center px-2 py-1 md:px-3 md:py-2\"\n                    >\n                      <svg\n                        className=\"h-3 w-3 md:h-4 md:w-4 mr-1\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          strokeWidth=\"2\"\n                          d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"\n                        />\n                      </svg>\n                      <span>{c.likes || 0}</span>\n                    </button>\n                  </motion.div>\n                </div>\n              </motion.div>\n            ))\n          ) : (\n            <p className=\"text-gray-500 text-center text-sm md:text-base\">\n              No comments yet. Be the first to comment!\n            </p>\n          )}\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto text-center mt-6 md:mt-8 space-x-4\">\n        <Link\n          to={`/profile/${location.state?.fromProfile || discussion.author?.username || \"unknown\"}`}\n          state={{ activeTab: location.state?.activeTab || \"discussion\" }}\n          className=\"text-blue-600 hover:underline font-semibold text-sm md:text-base\"\n        >\n          ← Back to Profile\n        </Link>\n        <Link to=\"/\" className=\"text-blue-600 hover:underline font-semibold text-sm md:text-base\">\n          ← Back to Home\n        </Link>\n      </div>\n    </div>\n  );\n};\n\nexport default DiscussionPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}